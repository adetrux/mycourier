version: "3.4"

services:
  ocelot.apigateway:
    image: ${DOCKER_REGISTRY-}ocelotapigateway
    build:
      context: .
      dockerfile: ApiGateways/Ocelot.ApiGateway/Dockerfile
    ports:
      - "7000:80"
      - "7001:443"
    networks:
      - mycouriernetwork

  users.api:
    image: ${DOCKER_REGISTRY-}usersapi
    build:
      context: .
      dockerfile: Services/Users/Users.Api/Dockerfile
    ports:
      - "7002:80"
      - "7003:443"
    depends_on:
      - usersdb
    networks:
      - mycouriernetwork

  routes.api:
    image: ${DOCKER_REGISTRY-}routesapi
    build:
      context: .
      dockerfile: Services/Routes/Routes.Api/Dockerfile
    ports:
      - "7004:80"
      - "7005:443"
    depends_on:
      - routesdb
    networks:
      - mycouriernetwork

  usersdb:
    image: "mcr.microsoft.com/mssql/server"
    environment:
      SA_PASSWORD: "Password123UsersDb"
      ACCEPT_EULA: "Y"
    ports:
      - "1433:1433"
    networks:
      - mycouriernetwork

  routesdb:
    image: "mcr.microsoft.com/mssql/server"
    environment:
      SA_PASSWORD: "Password123RoutesDb"
      ACCEPT_EULA: "Y"
    ports:
      - "1434:1433"
    networks:
      - mycouriernetwork

  mycourierweb:
    container_name: mycourierweb
    build:
      context: Clients/Web/mycourierweb
      dockerfile: Dockerfile
    ports:
      - "8000:80"
    networks:
      - mycouriernetwork

networks:
  mycouriernetwork:
    driver: bridge
